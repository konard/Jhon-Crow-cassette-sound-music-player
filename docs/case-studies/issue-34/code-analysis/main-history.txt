3a812ac Fix always-on-top error and hide window controls on small window
diff --git a/src/main.js b/src/main.js
index 748f581..7b6836c 100644
--- a/src/main.js
+++ b/src/main.js
@@ -406,11 +406,14 @@ ipcMain.on('save-settings', (event, settings) => {
 
 // Update always-on-top setting and save
 ipcMain.on('set-always-on-top', (event, value) => {
-  if (mainWindow) {
+  if (mainWindow && !mainWindow.isDestroyed()) {
     mainWindow.setAlwaysOnTop(value);
   }
-  // Also save to settings
+  // Also save to settings (ensure window property exists)
   if (currentSettings) {
+    if (!currentSettings.window) {
+      currentSettings.window = { ...DEFAULT_SETTINGS.window };
+    }
     currentSettings.window.alwaysOnTop = value;
     saveSettings(currentSettings);
   }
bab5b23 Add effects toggle, appearance fix, locked aspect ratio, responsive captions, and playback persistence
diff --git a/src/main.js b/src/main.js
index 4865741..748f581 100644
--- a/src/main.js
+++ b/src/main.js
@@ -16,7 +16,8 @@ const DEFAULT_SETTINGS = {
     wowFlutterLevel: 0.5,
     saturationLevel: 0.4,
     lowCutoff: 80,
-    highCutoff: 12000
+    highCutoff: 12000,
+    effectsEnabled: true
   },
   appearance: {
     gradientEnabled: false,
@@ -27,6 +28,10 @@ const DEFAULT_SETTINGS = {
   },
   window: {
     alwaysOnTop: false
+  },
+  playback: {
+    folderPath: null,
+    currentTrackIndex: 0
   }
 };
 
@@ -40,7 +45,8 @@ function loadSettings() {
       return {
         audio: { ...DEFAULT_SETTINGS.audio, ...loaded.audio },
         appearance: { ...DEFAULT_SETTINGS.appearance, ...loaded.appearance },
-        window: { ...DEFAULT_SETTINGS.window, ...loaded.window }
+        window: { ...DEFAULT_SETTINGS.window, ...loaded.window },
+        playback: { ...DEFAULT_SETTINGS.playback, ...loaded.playback }
       };
     }
   } catch (error) {
@@ -194,6 +200,9 @@ function createWindow() {
     mainWindow.hide();
   });
 
+  // Lock aspect ratio to 5:4 (same as initial window size 500x400)
+  mainWindow.setAspectRatio(5 / 4);
+
   // Remove default menu for cleaner look
   Menu.setApplicationMenu(null);
 }
@@ -406,3 +415,22 @@ ipcMain.on('set-always-on-top', (event, value) => {
     saveSettings(currentSettings);
   }
 });
+
+// Get audio files from a specific folder path (for restoring playback state)
+ipcMain.handle('get-audio-files-from-path', async (event, folderPath) => {
+  try {
+    // Check if the folder still exists
+    if (!fs.existsSync(folderPath)) {
+      return null;
+    }
+
+    const audioFiles = getAudioFilesFromFolder(folderPath);
+    return {
+      folderPath,
+      audioFiles
+    };
+  } catch (error) {
+    console.error('Error getting audio files from path:', error);
+    return null;
+  }
+});
9fa8315 Add recursive folder scanning, 70px min window size, and settings persistence
diff --git a/src/main.js b/src/main.js
index 125b149..4865741 100644
--- a/src/main.js
+++ b/src/main.js
@@ -5,6 +5,62 @@ const { app, BrowserWindow, ipcMain, dialog, Menu, Tray, nativeImage } = require
 const path = require('path');
 const fs = require('fs');
 
+// Settings file path in user data directory
+const SETTINGS_FILE = path.join(app.getPath('userData'), 'settings.json');
+
+// Default settings
+const DEFAULT_SETTINGS = {
+  audio: {
+    volume: 0.7,
+    tapeHissLevel: 0.3,
+    wowFlutterLevel: 0.5,
+    saturationLevel: 0.4,
+    lowCutoff: 80,
+    highCutoff: 12000
+  },
+  appearance: {
+    gradientEnabled: false,
+    gradientStartColor: '#1a1a2e',
+    gradientEndColor: '#2a2a4e',
+    gradientAngle: 180,
+    backgroundOpacity: 80
+  },
+  window: {
+    alwaysOnTop: false
+  }
+};
+
+// Load settings from file
+function loadSettings() {
+  try {
+    if (fs.existsSync(SETTINGS_FILE)) {
+      const data = fs.readFileSync(SETTINGS_FILE, 'utf8');
+      const loaded = JSON.parse(data);
+      // Merge with defaults to handle missing keys from older versions
+      return {
+        audio: { ...DEFAULT_SETTINGS.audio, ...loaded.audio },
+        appearance: { ...DEFAULT_SETTINGS.appearance, ...loaded.appearance },
+        window: { ...DEFAULT_SETTINGS.window, ...loaded.window }
+      };
+    }
+  } catch (error) {
+    console.error('Error loading settings:', error);
+  }
+  return { ...DEFAULT_SETTINGS };
+}
+
+// Save settings to file
+function saveSettings(settings) {
+  try {
+    fs.writeFileSync(SETTINGS_FILE, JSON.stringify(settings, null, 2), 'utf8');
+  } catch (error) {
+    console.error('Error saving settings:', error);
+  }
+}
+
+// Current settings (loaded on app start)
+let currentSettings = null;
+
 // Keep a global reference of the window object
 let mainWindow = null;
 let tray = null;
@@ -106,8 +162,8 @@ function createWindow() {
   mainWindow = new BrowserWindow({
     width: 500,
     height: 400,
-    minWidth: 400,
-    minHeight: 320,
+    minWidth: 70,
+    minHeight: 70,
     frame: false,
     transparent: true,
     resizable: true,
@@ -144,8 +200,15 @@ function createWindow() {
 
 // Create window when Electron is ready
 app.whenReady().then(() => {
+  // Load settings before creating window
+  currentSettings = loadSettings();
   createWindow();
   createTray();
+
+  // Apply saved always-on-top setting
+  if (currentSettings.window.alwaysOnTop && mainWindow) {
+    mainWindow.setAlwaysOnTop(true);
+  }
 });
 
 // Quit when all windows are closed
@@ -212,24 +275,44 @@ ipcMain.handle('open-file-dialog', async () => {
   };
 });
 
-// Get audio files from a folder
+// Get audio files from a folder (recursively scans subfolders)
 function getAudioFilesFromFolder(folderPath) {
   try {
-    const files = fs.readdirSync(folderPath);
-    return files
-      .filter(file => isAudioFile(file))
-      .map(file => ({
-        name: getFileDisplayName(file),
-        fullName: file,
-        path: path.join(folderPath, file)
-      }))
-      .sort((a, b) => a.name.localeCompare(b.name));
+    return getAudioFilesRecursive(folderPath).sort((a, b) => a.name.localeCompare(b.name));
   } catch (error) {
     console.error('Error reading folder:', error);
     return [];
   }
 }
 
+// Recursively get audio files from folder and all subfolders
+function getAudioFilesRecursive(folderPath) {
+  let audioFiles = [];
+
+  try {
+    const entries = fs.readdirSync(folderPath, { withFileTypes: true });
+
+    for (const entry of entries) {
+      const fullPath = path.join(folderPath, entry.name);
+
+      if (entry.isDirectory()) {
+        // Recursively scan subdirectory
+        audioFiles = audioFiles.concat(getAudioFilesRecursive(fullPath));
+      } else if (entry.isFile() && isAudioFile(entry.name)) {
+        audioFiles.push({
+          name: getFileDisplayName(entry.name),
+          fullName: entry.name,
+          path: fullPath
+        });
+      }
+    }
+  } catch (error) {
+    console.error('Error reading folder:', folderPath, error);
+  }
+
+  return audioFiles;
+}
+
 // Check if file is an audio file
 function isAudioFile(filename) {
   const ext = path.extname(filename).toLowerCase();
@@ -280,13 +363,7 @@ ipcMain.on('window-move', (event, deltaX, deltaY) => {
   }
 });
 
-// Always on top handlers
-ipcMain.on('set-always-on-top', (event, value) => {
-  if (mainWindow) {
-    mainWindow.setAlwaysOnTop(value);
-  }
-});
-
+// Always on top handler - get current state
 ipcMain.handle('get-always-on-top', () => {
   if (mainWindow) {
     return mainWindow.isAlwaysOnTop();
@@ -307,3 +384,25 @@ ipcMain.on('show-window', () => {
     mainWindow.focus();
   }
 });
+
+// Settings handlers
+ipcMain.handle('get-settings', () => {
+  return currentSettings;
+});
+
+ipcMain.on('save-settings', (event, settings) => {
+  currentSettings = settings;
+  saveSettings(settings);
+});
+
+// Update always-on-top setting and save
+ipcMain.on('set-always-on-top', (event, value) => {
+  if (mainWindow) {
+    mainWindow.setAlwaysOnTop(value);
+  }
+  // Also save to settings
+  if (currentSettings) {
+    currentSettings.window.alwaysOnTop = value;
+    saveSettings(currentSettings);
+  }
+});
0905de7 Add splash screen with progress bar for faster visual feedback
diff --git a/src/main.js b/src/main.js
index 125b149..b11df8e 100644
--- a/src/main.js
+++ b/src/main.js
@@ -5,8 +5,9 @@ const { app, BrowserWindow, ipcMain, dialog, Menu, Tray, nativeImage } = require
 const path = require('path');
 const fs = require('fs');
 
-// Keep a global reference of the window object
+// Keep a global reference of the window objects
 let mainWindow = null;
+let splashWindow = null;
 let tray = null;
 let isPlaying = false;
 
@@ -101,8 +102,55 @@ function updateTrayIcon() {
   }
 }
 
+// Create splash window with loading progress bar
+function createSplashWindow() {
+  splashWindow = new BrowserWindow({
+    width: 320,
+    height: 220,
+    frame: false,
+    transparent: true,
+    resizable: false,
+    center: true,
+    alwaysOnTop: true,
+    skipTaskbar: true,
+    icon: path.join(__dirname, '../assets/icon.png'),
+    webPreferences: {
+      nodeIntegration: false,
+      contextIsolation: true,
+      preload: path.join(__dirname, 'splash-preload.js')
+    }
+  });
+
+  splashWindow.loadFile(path.join(__dirname, 'splash.html'));
+
+  // Prevent window from being closed during loading
+  splashWindow.on('close', (e) => {
+    if (mainWindow && !mainWindow.isVisible()) {
+      e.preventDefault();
+    }
+  });
+
+  return splashWindow;
+}
+
+// Update splash screen progress
+function updateSplashProgress(progress, message) {
+  if (splashWindow && !splashWindow.isDestroyed()) {
+    splashWindow.webContents.send('splash-progress', progress, message);
+  }
+}
+
+// Close splash window when main window is ready
+function closeSplashWindow() {
+  if (splashWindow && !splashWindow.isDestroyed()) {
+    splashWindow.close();
+    splashWindow = null;
+  }
+}
+
 function createWindow() {
   // Create the browser window with transparent, frameless design
+  // Start hidden until fully loaded to avoid showing blank window
   mainWindow = new BrowserWindow({
     width: 500,
     height: 400,
@@ -111,6 +159,7 @@ function createWindow() {
     frame: false,
     transparent: true,
     resizable: true,
+    show: false,  // Start hidden
     icon: path.join(__dirname, '../assets/icon.png'),
     webPreferences: {
       nodeIntegration: false,
@@ -119,9 +168,17 @@ function createWindow() {
     }
   });
 
+  // Update splash progress when window starts loading
+  updateSplashProgress(10, 'Initializing window...');
+
   // Load the index.html file
   mainWindow.loadFile(path.join(__dirname, 'index.html'));
 
+  // Update splash progress when DOM is ready
+  mainWindow.webContents.on('dom-ready', () => {
+    updateSplashProgress(40, 'Loading 3D engine...');
+  });
+
   // Open DevTools in development mode
   if (process.argv.includes('--dev')) {
     mainWindow.webContents.openDevTools({ mode: 'detach' });
@@ -144,8 +201,15 @@ function createWindow() {
 
 // Create window when Electron is ready
 app.whenReady().then(() => {
-  createWindow();
-  createTray();
+  // Show splash screen immediately for fast visual feedback
+  createSplashWindow();
+
+  // Small delay to ensure splash is visible before heavy work
+  setTimeout(() => {
+    updateSplashProgress(5, 'Starting application...');
+    createWindow();
+    createTray();
+  }, 100);
 });
 
 // Quit when all windows are closed
@@ -307,3 +371,17 @@ ipcMain.on('show-window', () => {
     mainWindow.focus();
   }
 });
+
+// Splash screen progress updates from renderer
+ipcMain.on('splash-progress', (event, progress, message) => {
+  updateSplashProgress(progress, message);
+});
+
+// Main window ready - show it and close splash
+ipcMain.on('app-ready', () => {
+  if (mainWindow) {
+    mainWindow.show();
+    mainWindow.focus();
+    closeSplashWindow();
+  }
+});
58b5ecc Add ability to drag window by grabbing the cassette
diff --git a/src/main.js b/src/main.js
index 891bd63..125b149 100644
--- a/src/main.js
+++ b/src/main.js
@@ -262,9 +262,36 @@ ipcMain.on('window-close', () => {
   if (mainWindow) mainWindow.close();
 });
 
-// Drag window
+// Drag window by cassette - track start position
+let dragStartPosition = null;
+
 ipcMain.on('window-start-drag', () => {
-  // Window dragging is handled in renderer via -webkit-app-region: drag
+  if (mainWindow) {
+    const [x, y] = mainWindow.getPosition();
+    dragStartPosition = { x, y };
+  }
+});
+
+// Move window by delta from mouse movement
+ipcMain.on('window-move', (event, deltaX, deltaY) => {
+  if (mainWindow && dragStartPosition) {
+    const [currentX, currentY] = mainWindow.getPosition();
+    mainWindow.setPosition(currentX + deltaX, currentY + deltaY);
+  }
+});
+
+// Always on top handlers
+ipcMain.on('set-always-on-top', (event, value) => {
+  if (mainWindow) {
+    mainWindow.setAlwaysOnTop(value);
+  }
+});
+
+ipcMain.handle('get-always-on-top', () => {
+  if (mainWindow) {
+    return mainWindow.isAlwaysOnTop();
+  }
+  return false;
 });
 
 // Update play state from renderer and update tray icon
975e90c Add system tray control functionality
diff --git a/src/main.js b/src/main.js
index 814dd63..891bd63 100644
--- a/src/main.js
+++ b/src/main.js
@@ -1,16 +1,106 @@
 // Cassette Music Player - Main Process
 // Electron main process for the standalone cassette music player
 
-const { app, BrowserWindow, ipcMain, dialog, Menu } = require('electron');
+const { app, BrowserWindow, ipcMain, dialog, Menu, Tray, nativeImage } = require('electron');
 const path = require('path');
 const fs = require('fs');
 
 // Keep a global reference of the window object
 let mainWindow = null;
+let tray = null;
+let isPlaying = false;
 
 // Supported audio formats
 const AUDIO_EXTENSIONS = ['.mp3', '.wav', '.ogg', '.flac', '.aac', '.m4a', '.webm', '.opus', '.wma'];
 
+// Create play/pause tray icons programmatically
+function createTrayIcon(type) {
+  // Create a simple icon using nativeImage from raw RGBA data
+  const iconSize = 16;
+  const buffer = Buffer.alloc(iconSize * iconSize * 4);
+
+  // Fill with transparent background
+  for (let i = 0; i < buffer.length; i += 4) {
+    buffer[i] = 0;     // R
+    buffer[i + 1] = 0; // G
+    buffer[i + 2] = 0; // B
+    buffer[i + 3] = 0; // A (transparent)
+  }
+
+  // Draw icon based on type
+  if (type === 'play') {
+    // Draw play triangle (pointing right)
+    for (let y = 0; y < iconSize; y++) {
